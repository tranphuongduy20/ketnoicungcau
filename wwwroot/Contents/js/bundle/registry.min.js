function SubmitCreateCompany(){var n=$(".register-form").serializeArray();collectParam(n);$.ajax({url:"/Login/SubmitCreateCompanyNoOTP",type:"POST",cache:!1,data:n,beforeSend:function(){$(".preloader").show()},success:function(n){HidePreloader();n!==null&&n.code===200?($("div.register").remove(),$("header").after(n.data),CountDownRegistry()):($(".register .error-general").text(n.errormessage),$(".register .error-general").show())},error:function(){HidePreloader();alert(defaultErrorMessage);location.reload()}})}function ResendOTPRegistry(){var n=$(".otp-form").serializeArray();$.ajax({url:"/Login/ResendOTPRegistry",type:"POST",cache:!1,data:n,beforeSend:function(){$(".preloader").show()},success:function(n){HidePreloader();n!==null&&n.code===200?(flagResendOTPRegistry=!0,CountDownRegistry()):($(".register .error-general").text(n.errormessage),$(".register .error-general").show())},error:function(){HidePreloader();alert(defaultErrorMessage);location.reload()}})}function SubmitOTPRegistry(){var n=$(".otp-form").serialize();$.ajax({url:"/Login/SubmitOTPRegistry",type:"POST",cache:!1,data:n,beforeSend:function(){$(".preloader").show()},success:function(n){HidePreloader();n!==null&&n.code===200?($("div.otp").remove(),$("header").after(n.data)):($("#otp-error").prev().addClass("error"),$("#otp-error").text(n.errormessage),$("#otp-error").show())},error:function(){HidePreloader();alert(defaultErrorMessage);location.reload()}})}function CountDownRegistry(){$("#send-otp-again-registry").hide();$("#timer-registry").text("Thời gian còn lại: 1:00");$("#timer-registry").show();var n=60,t=setInterval(function(){n<10?$("#timer-registry").text("Thời gian còn lại: 0:0"+n):$("#timer-registry").text("Thời gian còn lại: 0:"+n);n--;n==00&&(flagResendOTP?$("#timer-registry").text("OTP đã hết hạn, vui lòng thử lại sau"):($("#send-otp-again-registry").show(),$("#timer-registry").hide()),clearInterval(t))},1e3)}function ImgUpload(){var t="",n=[];$(".uploadmulti__inputfile").each(function(){$(this).on("change",function(i){t=$(this).closest(".uploadmulti__box").find(".uploadmulti__img-wrap");var r=$(this).attr("data-max_length"),u=i.target.files,f=Array.prototype.slice.call(u),e=0;f.forEach(function(i){var f,u,o;if(i.type.match("image.*")){if(n.length>r)return!1;for(f=0,u=0;u<n.length;u++)n[u]!==undefined&&f++;if(f>r)return!1;n.push(i);o=new FileReader;o.onload=function(n){var r="<div class='uploadmulti__img-box'><div style='background-image: url("+n.target.result+")' data-number='"+$(".uploadmulti__img-close").length+"' data-file='"+i.name+"' class='img-bg'><div class='uploadmulti__img-close'><i class='icon-clearfile'><\/i><\/div><\/div><\/div>";t.prepend(r);e++};o.readAsDataURL(i)}})})});$("body").on("click",".uploadmulti__img-close",function(){for(var i=$(this).parent().data("file"),t=0;t<n.length;t++)if(n[t].name===i){n.splice(t,1);break}$(this).parent().parent().remove()})}function closePopupFilter(n){$(n.target).closest(".filter__item").length==0&&($(".filter-search input").val(""),$(".filter-main").hide("fast"),$(".filter__item").removeClass("current-filter"),$(".filter-search input").each(function(){searchFilterCommon($(this))}));handleFilterText()}function handleFilterText(){var i=$("#list-cate .filter-main ul li.act"),t,n;i.length>0?(n=[],i.each(function(){n.push($(this).text())}),$("#list-cate label").addClass("freeze"),$("#list-cate input:first").val(n.join(", "))):($("#list-cate label").removeClass("freeze"),$("#list-cate input:first").val(""));t=$("#list-province .filter-main ul li.act");t.length>0?(n=[],t.each(function(){n.push($(this).text())}),$("#list-province label").addClass("freeze"),$("#list-province input:first").val(n.join(", "))):($("#list-province label").removeClass("freeze"),$("#list-province input:first").val(""));flagValidateFilter&&$(".register-form").valid()}function collectParam(n){var i,r,t,u;n.push({name:"Logosrc",value:logosrcPath});n.push({name:"Gpkdsrc",value:gpkdsrcPath});n.push({name:"Description",value:tinyMCE.activeEditor.getContent()});i=$("#list-cate .filter-main ul li.act");i.length>0?(t=[],i.each(function(){t.push($(this).data("id"))}),t=t.filter(unique),n.find(n=>n.name=="Listcategoryid").value=t.join()):n.find(n=>n.name=="Listcategoryid").value="";r=$("#list-province .filter-main ul li.act");r.length>0?(t=[],r.each(function(){t.push($(this).data("id"))}),t=t.filter(unique),n.find(n=>n.name=="Provinceid").value=t.join()):n.find(n=>n.name=="Provinceid").value="";u=isMobile?".register-form #g-recaptcha-response-1":".register-form #g-recaptcha-response-2";n.push({name:"Captcha",value:$(u).val()});$("#Fburl").val().includes("https://")==!1&&$("#Fburl").val()!=""&&(n.find(n=>n.name=="Fburl").value="https://"+$("#Fburl").val());$("#Weburl").val().includes("http")==!1&&$("#Weburl").val()!=""&&(n.find(n=>n.name=="Weburl").value="https://"+$("#Weburl").val())}var defaultErrorMessage="Hệ thống đang cập nhật, vui lòng thử lại sau",logosrcPath="",gpkdsrcPath="",flagResendOTPRegistry=!1,flagValidateFilter=!1;$(document).ready(function(){var n=300,t;isMobile&&(n=150);document.isCkeditor!=undefined&&document.isCkeditor==!0&&document.nametinyMCECkeditor!=undefined&&document.nameCkeditor!=undefined&&$(document).ready(function(){document.nametinyMCECkeditor=null;tinymce.init({selector:`#${document.nameCkeditor}`,height:n,relative_urls:!1,plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor lineheight"],menubar:"true",toolbar:"undo redo | formatselect | bold italic | pastetext alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | imageupload | media",setup:function(n){n.addButton("imageupload",{text:"",icon:"image",tooltip:"Insert/edit image",onclick:function(){$(`#${document.nameCkeditor}_upload`).trigger("click");document.nametinyMCECkeditor=n}})},image_advtab:!0,skin:"lightgray",init_instance_callback:function(n){n.on("keyUp",function(){$(`#${document.nameCkeditor}`).val(n.getContent())})}});$(`#${document.nameCkeditor}_upload`).html5Uploader({postUrl:"/Common/UploadImageCkEditor",onClientLoadEnd:function(){},onServerLoadStart:function(){},onServerProgress:function(){},onServerLoad:function(){},onSuccess:function(n){var t=$.parseJSON(n.currentTarget.response);if(t.code!=200){alert(t.errormessage);return}document.nametinyMCECkeditor!=null&&document.nametinyMCECkeditor!=undefined&&document.nametinyMCECkeditor.insertContent('<img src="'+t.message+'" />')}})});$(".form-field").each(function(){$(this).find("input").val()!=""?$(this).find("label").addClass("freeze"):$(this).find("label").removeClass("freeze")});t=$(".form-field");t.each(function(){function r(){var n=t.val().length;n>0?i.addClass("freeze"):i.removeClass("freeze")}var n=$(this),t=n.find("input"),i=n.find("label");t.change(function(){r()})});OffScrollCommon();$(document).on("click",".filter__item input",function(n){if($(this).hasClass("filter-input")){n.preventDefault();var t=$(".filter-input.current-filter").not(this);t.removeClass(".current-filter");t.toggleClass("current-filter").nextAll(".filter-main").fadeOut(300);$(this).toggleClass("current-filter").nextAll(".filter-main").fadeToggle("fast");$(this).parent(".filter__item").toggleClass("current-filter");isMobile&&$(".bgsend-overlay").show()}});$(document).on("click",".filter-main ul li",function(){$(this).toggleClass("act")});$(".radio-item").click(function(){$(".radio-item").removeClass("act-check");$(this).addClass("act-check")});$(".box-show").click(function(){$(this).toggleClass("rotate");$(".boxlist").fadeToggle()});$(document).on("keyup",".filter-search input",function(){searchFilterCommon($(this))});$(document).click(function(n){closePopupFilter(n)});$("#Logosrc").on("change",function(){$("#logo-error").hide();var n=new FormData;$($("#Logosrc[type=file]")[0].files).each(function(t,i){n.append("files"+t,i)});$.ajax({type:"POST",url:"/Login/UploadLogo",contentType:!1,processData:!1,data:n,beforeSend:function(){$(".preloader").show()},success:function(n){n.code==-1?($("#logo-error").text(n.errormessage),$("#logo-error").show()):n.message!=""&&(logosrcPath=n.message);HidePreloader()},error:function(){HidePreloader();alert(defaultErrorMessage);location.reload()}})});$("#Gpkdsrc").on("change",function(){$("#gpkd-error").hide();var n=new FormData;$($("#Gpkdsrc[type=file]")[0].files).each(function(t,i){n.append("files"+t,i)});$.ajax({type:"POST",url:"/Login/UploadBusinessLicense",contentType:!1,processData:!1,data:n,beforeSend:function(){$(".preloader").show()},success:function(n){n.code==-1?($("#gpkd-error").text(n.errormessage),$("#gpkd-error").show()):n.message!=""&&(gpkdsrcPath=n.message);HidePreloader()},error:function(){HidePreloader();alert(defaultErrorMessage);location.reload()}})});$(".register-form").validate({errorElement:"div",errorClass:"error",errorPlacement:function(n,t){n.insertAfter(t.next("label"))},rules:{Companyname:{required:!0},Taxid:{required:!0,isTaxId:!0},Phonenumber:{required:!0,digits:!0,minlength:10,maxlength:10,isPhonenumber:!0},Password:{required:!0,minlength:6,maxlength:20},ConfirmPassword:{required:!0,equalTo:"#Password",minlength:6,maxlength:20},Listcategoryid:{required:!0},Provinceid:{required:!0},Address:{required:!0,maxlength:200},Email:{required:!0,email:!0},Zaloid:{required:!0,digits:!0,minlength:5,maxlength:20},Description:{required:!0},Representname:{required:!0},Representposition:{required:!0}},messages:{Companyname:{required:"Vui lòng nhập tên công ty"},Taxid:{required:"Vui lòng nhập mã số thuế"},Phonenumber:{required:"Vui lòng nhập số điện thoại",minlength:"Vui lòng nhập số điện thoại gồm 10 chữ số",digits:"Số điện thoại chỉ bao gồm chữ số",maxlength:"Vui lòng nhập số điện thoại gồm 10 chữ số"},Password:{required:"Vui lòng nhập mật khẩu mới",minlength:"Mật khẩu mới quá ngắn, vui lòng nhập tối thiểu 6 ký tự",maxlength:"Mật khẩu mới quá dài, vui lòng nhập tối đa 20 ký tự"},ConfirmPassword:{required:"Vui lòng nhập lại mật khẩu mới",minlength:"Mật khẩu mới quá ngắn, vui lòng nhập tối thiểu 6 ký tự",maxlength:"Mật khẩu mới quá dài, vui lòng nhập tối đa 20 ký tự",equalTo:"Vui lòng nhập mật khẩu trùng khớp nhau"},Listcategoryid:{required:"Vui lòng chọn ít nhất một danh mục sản phẩm"},Provinceid:{required:"Vui lòng chọn ít nhất một Tỉnh/ Thành phố"},Address:{required:"Vui lòng nhập địa chỉ",maxlength:"Địa chỉ quá dài, vui lòng nhập tối đa 200 ký tự"},Email:{required:"Vui lòng nhập email của bạn",email:"Vui lòng nhập email hợp lệ"},Zaloid:{required:"Vui lòng nhập số điện thoại liên kết Zalo",minlength:"Vui lòng nhập hotline nhiều hơn 5 chữ số",digits:"Số điện thoại chỉ bao gồm chữ số",maxlength:"Vui lòng nhập hotline bé hơn 20 chữ số"},Description:{required:"Vui lòng nhập mô tả sản phẩm"},Representname:{required:"Vui lòng nhập tên người đại diện"},Representposition:{required:"Vui lòng nhập chức vụ người đại diện"}}});$(".register-form").submit(function(n){flagValidateFilter=!0;$(".register-form").valid()&&logosrcPath!=""&&gpkdsrcPath!=""&&(n.preventDefault(),SubmitCreateCompany());logosrcPath==""?($("#logo-error").text("Vui lòng upload logo doanh nghiệp"),$("#logo-error").show()):$("#logo-error").hide();gpkdsrcPath==""?($("#gpkd-error").text("Vui lòng upload giấy phép kinh doanh"),$("#gpkd-error").show()):$("#gpkd-error").hide()});$(document).on("submit",".otp .otp-form",function(n){n.preventDefault();$(".otp-form input.input-field").val()==""?($("#otp-error").prev().addClass("error"),$("#otp-error").text("Vui lòng nhập mã OTP"),$("#otp-error").show()):($("#otp-error").prev().removeClass("error"),$("#otp-error").hide(),SubmitOTPRegistry())});$(document).on("click","#send-otp-again-registry",function(){ResendOTPRegistry()});ImgUpload();handleFilterText()});