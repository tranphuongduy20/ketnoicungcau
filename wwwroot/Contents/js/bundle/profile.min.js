function ImgUpload(){var t="",n=[];$(".uploadmulti__inputfile").each(function(){$(this).on("change",function(i){t=$(this).closest(".uploadmulti__box").find(".uploadmulti__img-wrap");var r=$(this).attr("data-max_length"),u=i.target.files,f=Array.prototype.slice.call(u),e=0;f.forEach(function(i){var f,u,o;if(i.type.match("image.*")){if(n.length>r)return!1;for(f=0,u=0;u<n.length;u++)n[u]!==undefined&&f++;if(f>r)return!1;n.push(i);o=new FileReader;o.onload=function(n){var r="<div class='uploadmulti__img-box'><div style='background-image: url("+n.target.result+")' data-number='"+$(".uploadmulti__img-close").length+"' data-file='"+i.name+"' class='img-bg'><div class='uploadmulti__img-close'><i class='icon-clearfile'><\/i><\/div><\/div><\/div>";t.prepend(r);e++};o.readAsDataURL(i)}})})});$("body").on("click",".uploadmulti__img-close",function(){for(var i=$(this).parent().data("file"),t=0;t<n.length;t++)if(n[t].name===i){n.splice(t,1);break}$(this).parent().parent().remove()})}function closePopupFilter(n){$(n.target).closest(".filter__item").length==0&&($(".filter-search input").val(""),$(".filter-main").hide("fast"),$(".filter__item").removeClass("current-filter"),$(".filter-search input").each(function(){searchFilterCommon($(this))}));handleFilterText()}function handleFilterText(){var i=$("#list-cate .filter-main ul li.act"),t,n;i.length>0?(n=[],i.each(function(){n.push($(this).text())}),$("#list-cate label").addClass("freeze"),$("#list-cate input:first").val(n.join(", "))):($("#list-cate label").removeClass("freeze"),$("#list-cate input:first").val(""));t=$("#list-province .filter-main ul li.act");t.length>0?(n=[],t.each(function(){n.push($(this).text())}),$("#list-province label").addClass("freeze"),$("#list-province input:first").val(n.join(", "))):($("#list-province label").removeClass("freeze"),$("#list-province input:first").val(""));flagValidateFilter&&$("#frmChangeInfo").length>0&&$("#frmChangeInfo").valid()}function SubmitChangeInfo(){var n=$("#frmChangeInfo").serializeArray();collectParamChangeInfo(n);$.ajax({url:"/Profile/SubmitChangeInfo",type:"POST",cache:!1,data:n,beforeSend:function(){$(".preloader").show()},success:function(n){HidePreloader();n!==""&&n.code===200?($("div.error-general").hide(),ShowPopupNotify(n.message)):($(".profile .error-general").text(n.errormessage),$(".profile .error-general").show())},error:function(){HidePreloader();alert(defaultErrorMessage);location.reload()}})}function collectParamChangeInfo(n){var i,r,t;n.push({name:"Logosrc",value:logosrcPath});n.push({name:"Gpkdsrc",value:gpkdsrcPath});n.push({name:"Description",value:tinyMCE.activeEditor.getContent()});n.push({name:"Provinceoldid",value:Provinceoldid});i=$("#list-cate .filter-main ul li.act");i.length>0?(t=[],i.each(function(){t.push($(this).data("id"))}),t=t.filter(unique),n.find(n=>n.name=="Listcategoryid").value=t.join()):n.find(n=>n.name=="Listcategoryid").value="";r=$("#list-province .filter-main ul li.act");r.length>0?(t=[],r.each(function(){t.push($(this).data("id"))}),t=t.filter(unique),n.find(n=>n.name=="Provinceid").value=t.join()):n.find(n=>n.name=="Provinceid").value="";$("#Fburl").val().includes("https://")==!1&&$("#Fburl").val()!=""&&(n.find(n=>n.name=="Fburl").value="https://"+$("#Fburl").val());$("#Weburl").val().includes("http")==!1&&$("#Weburl").val()!=""&&(n.find(n=>n.name=="Weburl").value="https://"+$("#Weburl").val())}var flagValidateFilter=!1;$(document).ready(function(){var n=300,t;isMobile&&(n=150);document.isCkeditor!=undefined&&document.isCkeditor==!0&&document.nametinyMCECkeditor!=undefined&&document.nameCkeditor!=undefined&&$(document).ready(function(){document.nametinyMCECkeditor=null;tinymce.init({selector:`#${document.nameCkeditor}`,height:n,relative_urls:!1,plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor lineheight"],menubar:"true",toolbar:"undo redo | formatselect | bold italic | pastetext alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | imageupload | media",setup:function(n){n.addButton("imageupload",{text:"",icon:"image",tooltip:"Insert/edit image",onclick:function(){$(`#${document.nameCkeditor}_upload`).trigger("click");document.nametinyMCECkeditor=n}})},image_advtab:!0,skin:"lightgray",init_instance_callback:function(n){n.on("keyUp",function(){$(`#${document.nameCkeditor}`).val(n.getContent())})}});$(`#${document.nameCkeditor}_upload`).html5Uploader({postUrl:"/Common/UploadImageCkEditor",onClientLoadEnd:function(){},onServerLoadStart:function(){},onServerProgress:function(){},onServerLoad:function(){},onSuccess:function(n){var t=$.parseJSON(n.currentTarget.response);if(t.code!=200){alert(t.errormessage);return}document.nametinyMCECkeditor!=null&&document.nametinyMCECkeditor!=undefined&&(document.nametinyMCECkeditor.insertContent('<img src="'+t.message+'" />'),console.log(t.message),console.log('<img src="'+t.message+'" />'))}})});OffScrollCommon();$(document).on("click",".filter__item input",function(n){if($(this).hasClass("filter-input")){n.preventDefault();var t=$(".filter-input.current-filter").not(this);t.removeClass(".current-filter");t.toggleClass("current-filter").nextAll(".filter-main").fadeOut(300);$(this).toggleClass("current-filter").nextAll(".filter-main").fadeToggle("fast");$(this).parent(".filter__item").toggleClass("current-filter");isMobile&&$(".bgsend-overlay").show()}});$(document).on("click",".filter-main ul li",function(){$(this).toggleClass("act")});$(".box-show").click(function(){$(this).toggleClass("rotate");$(".boxlist").fadeToggle()});$(document).on("keyup",".filter-search input",function(){searchFilterCommon($(this))});$(document).click(function(n){closePopupFilter(n)});$(".form-field").each(function(){$(this).find("input").val()!=""?$(this).find("label").addClass("freeze"):$(this).find("label").removeClass("freeze");$(this).find("label").hasClass("always-freeze")&&($(this).find("label").addClass("freeze"),console.log("freeze"))});t=$(".form-field");t.each(function(){function r(){var n=t.val().length;n>0?i.addClass("freeze"):i.removeClass("freeze")}var n=$(this),t=n.find("input"),i=n.find("label");t.change(function(){r()})});handleFilterText()}),function(n){n.fn.html5Uploader=function(t){function e(n){var e=new FileReader,t,s,o;e.onabort=function(t){if(i.onClientAbort)i.onClientAbort(t,n)};e.onerror=function(t){if(i.onClientError)i.onClientError(t,n)};e.onload=function(t){if(i.onClientLoad)i.onClientLoad(t,n)};e.onloadend=function(t){if(i.onClientLoadEnd)i.onClientLoadEnd(t,n)};e.onloadstart=function(t){if(i.onClientLoadStart)i.onClientLoadStart(t,n)};e.onprogress=function(t){if(i.onClientProgress)i.onClientProgress(t,n)};e.readAsDataURL(n);t=new XMLHttpRequest;t.upload.onabort=function(t){if(i.onServerAbort)i.onServerAbort(t,n)};t.upload.onerror=function(t){if(i.onServerError)i.onServerError(t,n)};t.upload.onload=function(t){if(i.onServerLoad)i.onServerLoad(t,n)};t.upload.onloadstart=function(t){if(i.onServerLoadStart)i.onServerLoadStart(t,n)};t.upload.onprogress=function(t){if(i.onServerProgress)i.onServerProgress(t,n)};t.onreadystatechange=function(r){if(i.onServerReadyStateChange)i.onServerReadyStateChange(r,n,t.readyState);if(i.onSuccess&&t.readyState==4&&t.status==200)i.onSuccess(r,n,t.responseText);if(i.onServerError&&t.readyState==2&&t.status==500)i.onServerError(r,n)};t.open("POST",i.postUrl,!0);n.getAsBinary?(s=f+u+r+'Content-Disposition: form-data;name="'+i.name+'";filename="'+unescape(encodeURIComponent(n.name))+'"'+r+"Content-Type: application/octet-stream"+r+r+n.getAsBinary()+r+f+u+f,t.setRequestHeader("Content-Type","multipart/form-data;boundary="+u),t.sendAsBinary(s)):window.FormData&&(o=new FormData,o.append(i.name,n),t.send(o))}var r="\r\n",u="iloveigloo",f="--",i={name:"uploadedFile",postUrl:"Upload.ashx",onClientAbort:null,onClientError:null,onClientLoad:null,onClientLoadEnd:null,onClientLoadStart:null,onClientProgress:null,onServerAbort:null,onServerError:null,onServerLoad:null,onServerLoadStart:null,onServerProgress:null,onServerReadyStateChange:null,onSuccess:null,limitItem:30};return t&&n.extend(i,t),this.each(function(){var t=n(this);t.is('[type="file"]')?t.bind("change",function(){for(var t=this.files,n=0;n<t.length;n++)n<i.limitItem&&e(t[n])}):t.bind("dragenter dragover",function(){return!1}).bind("drop",function(n){for(var i=n.originalEvent.dataTransfer.files,t=0;t<i.length;t++)e(i[t]);return!1})})}}(jQuery);$(document).ready(function(){var t,n;$("#Logosrc").on("change",function(){$("#logo-error").hide();var n=new FormData;$($("#Logosrc[type=file]")[0].files).each(function(t,i){n.append("files"+t,i)});$.ajax({type:"POST",url:"/Login/UploadLogo",contentType:!1,processData:!1,data:n,beforeSend:function(){$(".preloader").show()},success:function(n){n.code==-1?($("#logo-error").text(n.errormessage),$("#logo-error").show()):n.message!=""&&(logosrcPath=n.message);HidePreloader()},error:function(){HidePreloader();alert(defaultErrorMessage);location.reload()}})});$("#Gpkdsrc").on("change",function(){$("#gpkd-error").hide();var n=new FormData;$($("#Gpkdsrc[type=file]")[0].files).each(function(t,i){n.append("files"+t,i)});$.ajax({type:"POST",url:"/Login/UploadBusinessLicense",contentType:!1,processData:!1,data:n,beforeSend:function(){$(".preloader").show()},success:function(n){n.code==-1?($("#gpkd-error").text(n.errormessage),$("#gpkd-error").show()):n.message!=""&&(gpkdsrcPath=n.message);HidePreloader()},error:function(){HidePreloader();alert(defaultErrorMessage);location.reload()}})});$("#frmChangeInfo").validate({errorElement:"div",errorClass:"error",errorPlacement:function(n,t){n.insertAfter(t.next("label"))},rules:{Companyname:{required:!0},Taxid:{required:!0,isTaxId:!0},Phonenumber:{required:!0,digits:!0,minlength:10,maxlength:10,isPhonenumber:!0},Listcategoryid:{required:!0},Provinceid:{required:!0},Address:{required:!0,maxlength:200},Email:{required:!0,email:!0},Zaloid:{required:!0,digits:!0,minlength:5,maxlength:20},Description:{required:!0},Representname:{required:!0},Representposition:{required:!0}},messages:{Companyname:{required:"Vui lòng nhập tên công ty"},Taxid:{required:"Vui lòng nhập mã số thuế"},Phonenumber:{required:"Vui lòng nhập số điện thoại",minlength:"Vui lòng nhập số điện thoại gồm 10 chữ số",digits:"Số điện thoại chỉ bao gồm chữ số",maxlength:"Vui lòng nhập số điện thoại gồm 10 chữ số"},Listcategoryid:{required:"Vui lòng chọn ít nhất một danh mục sản phẩm"},Provinceid:{required:"Vui lòng chọn ít nhất một Tỉnh/ Thành phố"},Address:{required:"Vui lòng nhập địa chỉ",maxlength:"Địa chỉ quá dài, vui lòng nhập tối đa 200 ký tự"},Email:{required:"Vui lòng nhập email của bạn",email:"Vui lòng nhập email hợp lệ"},Zaloid:{required:"Vui lòng nhập số điện thoại liên kết Zalo",minlength:"Vui lòng nhập hotline nhiều hơn 5 chữ số",digits:"Số điện thoại chỉ bao gồm chữ số",maxlength:"Vui lòng nhập hotline ít hơn 20 chữ số"},Description:{required:"Vui lòng nhập mô tả sản phẩm"},Representname:{required:"Vui lòng nhập tên người đại diện"},Representposition:{required:"Vui lòng nhập chức vụ người đại diện"}}});$("#frmChangeInfo").submit(function(n){flagValidateFilter=!0;n.preventDefault();$("#frmChangeInfo").valid()&&logosrcPath!=""&&gpkdsrcPath!=""&&SubmitChangeInfo();logosrcPath==""?($("#logo-error").text("Vui lòng upload logo doanh nghiệp"),$("#logo-error").show()):$("#logo-error").hide();gpkdsrcPath==""?($("#gpkd-error").text("Vui lòng upload giấy phép kinh doanh"),$("#gpkd-error").show()):$("#gpkd-error").hide()});ImgUpload();t=$("#list-province .filter-main ul li.act");t.length>0&&(n=[],t.each(function(){n.push($(this).data("id"))}),n=n.filter(unique),Provinceoldid=n.join())});