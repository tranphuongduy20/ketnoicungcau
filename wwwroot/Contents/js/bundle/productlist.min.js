function ImgUpload(){var t="",n=[];$(".uploadmulti__inputfile").each(function(){$(this).on("change",function(i){t=$(this).closest(".uploadmulti__box").find(".uploadmulti__img-wrap");var r=$(this).attr("data-max_length"),u=i.target.files,f=Array.prototype.slice.call(u),e=0;f.forEach(function(i){var f,u,o;if(i.type.match("image.*")){if(n.length>r)return!1;for(f=0,u=0;u<n.length;u++)n[u]!==undefined&&f++;if(f>r)return!1;n.push(i);o=new FileReader;o.onload=function(n){var r="<div class='uploadmulti__img-box'><div style='background-image: url("+n.target.result+")' data-number='"+$(".uploadmulti__img-close").length+"' data-file='"+i.name+"' class='img-bg'><div class='uploadmulti__img-close'><i class='icon-clearfile'><\/i><\/div><\/div><\/div>";t.prepend(r);e++};o.readAsDataURL(i)}})})});$("body").on("click",".uploadmulti__img-close",function(){for(var i=$(this).parent().data("file"),t=0;t<n.length;t++)if(n[t].name===i){n.splice(t,1);break}$(this).parent().parent().remove()})}function closePopupFilter(n){$(n.target).closest(".filter__item").length==0&&($(".filter-search input").val(""),$(".filter-main").hide("fast"),$(".filter__item").removeClass("current-filter"),$(".filter-search input").each(function(){searchFilterCommon($(this))}));handleFilterText()}function handleFilterText(){var i=$("#list-cate .filter-main ul li.act"),t,n;i.length>0?(n=[],i.each(function(){n.push($(this).text())}),$("#list-cate label").addClass("freeze"),$("#list-cate input:first").val(n.join(", "))):($("#list-cate label").removeClass("freeze"),$("#list-cate input:first").val(""));t=$("#list-province .filter-main ul li.act");t.length>0?(n=[],t.each(function(){n.push($(this).text())}),$("#list-province label").addClass("freeze"),$("#list-province input:first").val(n.join(", "))):($("#list-province label").removeClass("freeze"),$("#list-province input:first").val(""));flagValidateFilter&&$("#frmChangeInfo").length>0&&$("#frmChangeInfo").valid()}function ActiveSwitch(n){elm=n;isActive=$(elm).is(":checked");idActive=$(elm).data("id");$(elm).prop("checked",!isActive);$(".popup-update-status").addClass("active")}function getProductList(n){if(!searching){searching=!0;var t=n.trim().toString().toLowerCase();t.length<MIN_SSKEYWORD_LENGTH||t.length>=MIN_SSKEYWORD_LENGTH&&(query.Keyword=t,$.ajax({url:"Profile/GetProductList",type:"POST",data:query,cache:!1,beforeSend:function(){$(".preloader").show()},success:function(n){if(HidePreloader(),n==null||n.listProduct===""||n.listProduct.trim()==="")$(".table-buyandsell tbody").html('<li id="empty"><i class="empty"><\/i>Không có sản phẩm nào phù hợp với tiêu chí tìm kiếm!<\/li>');else $(".table-buyandsell tbody").html(n.listProduct),handleReadMore(".seemore-another",n.left)},error:function(){HidePreloader()}}),searching=!1)}}function viewMoreProduct(){query.PageIndex=query.PageIndex+1;$.ajax({url:"Profile/GetProductList",type:"POST",data:query,cache:!1,beforeSend:function(){$(".preloader").show()},success:function(n){HidePreloader();n==null||n.listProduct===""||n.listProduct.trim()===""||($(".table-buyandsell tbody").append(n.listProduct),handleReadMore(".seemore-another",n.left))},error:function(){HidePreloader()}})}function SubmitDeleteProduct(n){$.ajax({url:"/Profile/DeleteProduct?id="+n,type:"POST",cache:!1,beforeSend:function(){$(".preloader").show()},success:function(n){HidePreloader();n!==""&&n.code===200?($("div.error-general").hide(),ShowPopupNotify(n.message)):($("div .error-general").text(n.errormessage),$("div .error-general").show())},error:function(){HidePreloader();ShowPopupNotify(defaultErrorMessage)}})}function handleReadMore(n,t){t>0?($(n).show(),$(n).text(`Xem thêm ${t} sản phẩm`)):$(n).hide()}var flagValidateFilter=!1;$(document).ready(function(){var n=300,t;isMobile&&(n=150);document.isCkeditor!=undefined&&document.isCkeditor==!0&&document.nametinyMCECkeditor!=undefined&&document.nameCkeditor!=undefined&&$(document).ready(function(){document.nametinyMCECkeditor=null;tinymce.init({selector:`#${document.nameCkeditor}`,height:n,relative_urls:!1,plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor lineheight"],menubar:"true",toolbar:"undo redo | formatselect | bold italic | pastetext alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link | imageupload | media",setup:function(n){n.addButton("imageupload",{text:"",icon:"image",tooltip:"Insert/edit image",onclick:function(){$(`#${document.nameCkeditor}_upload`).trigger("click");document.nametinyMCECkeditor=n}})},image_advtab:!0,skin:"lightgray",init_instance_callback:function(n){n.on("keyUp",function(){$(`#${document.nameCkeditor}`).val(n.getContent())})}});$(`#${document.nameCkeditor}_upload`).html5Uploader({postUrl:"/Common/UploadImageCkEditor",onClientLoadEnd:function(){},onServerLoadStart:function(){},onServerProgress:function(){},onServerLoad:function(){},onSuccess:function(n){var t=$.parseJSON(n.currentTarget.response);if(t.code!=200){alert(t.errormessage);return}document.nametinyMCECkeditor!=null&&document.nametinyMCECkeditor!=undefined&&(document.nametinyMCECkeditor.insertContent('<img src="'+t.message+'" />'),console.log(t.message),console.log('<img src="'+t.message+'" />'))}})});OffScrollCommon();$(document).on("click",".filter__item input",function(n){if($(this).hasClass("filter-input")){n.preventDefault();var t=$(".filter-input.current-filter").not(this);t.removeClass(".current-filter");t.toggleClass("current-filter").nextAll(".filter-main").fadeOut(300);$(this).toggleClass("current-filter").nextAll(".filter-main").fadeToggle("fast");$(this).parent(".filter__item").toggleClass("current-filter");isMobile&&$(".bgsend-overlay").show()}});$(document).on("click",".filter-main ul li",function(){$(this).toggleClass("act")});$(".box-show").click(function(){$(this).toggleClass("rotate");$(".boxlist").fadeToggle()});$(document).on("keyup",".filter-search input",function(){searchFilterCommon($(this))});$(document).click(function(n){closePopupFilter(n)});$(".form-field").each(function(){$(this).find("input").val()!=""?$(this).find("label").addClass("freeze"):$(this).find("label").removeClass("freeze");$(this).find("label").hasClass("always-freeze")&&($(this).find("label").addClass("freeze"),console.log("freeze"))});t=$(".form-field");t.each(function(){function r(){var n=t.val().length;n>0?i.addClass("freeze"):i.removeClass("freeze")}var n=$(this),t=n.find("input"),i=n.find("label");t.change(function(){r()})});handleFilterText()}),function(n){n.fn.html5Uploader=function(t){function e(n){var e=new FileReader,t,s,o;e.onabort=function(t){if(i.onClientAbort)i.onClientAbort(t,n)};e.onerror=function(t){if(i.onClientError)i.onClientError(t,n)};e.onload=function(t){if(i.onClientLoad)i.onClientLoad(t,n)};e.onloadend=function(t){if(i.onClientLoadEnd)i.onClientLoadEnd(t,n)};e.onloadstart=function(t){if(i.onClientLoadStart)i.onClientLoadStart(t,n)};e.onprogress=function(t){if(i.onClientProgress)i.onClientProgress(t,n)};e.readAsDataURL(n);t=new XMLHttpRequest;t.upload.onabort=function(t){if(i.onServerAbort)i.onServerAbort(t,n)};t.upload.onerror=function(t){if(i.onServerError)i.onServerError(t,n)};t.upload.onload=function(t){if(i.onServerLoad)i.onServerLoad(t,n)};t.upload.onloadstart=function(t){if(i.onServerLoadStart)i.onServerLoadStart(t,n)};t.upload.onprogress=function(t){if(i.onServerProgress)i.onServerProgress(t,n)};t.onreadystatechange=function(r){if(i.onServerReadyStateChange)i.onServerReadyStateChange(r,n,t.readyState);if(i.onSuccess&&t.readyState==4&&t.status==200)i.onSuccess(r,n,t.responseText);if(i.onServerError&&t.readyState==2&&t.status==500)i.onServerError(r,n)};t.open("POST",i.postUrl,!0);n.getAsBinary?(s=f+u+r+'Content-Disposition: form-data;name="'+i.name+'";filename="'+unescape(encodeURIComponent(n.name))+'"'+r+"Content-Type: application/octet-stream"+r+r+n.getAsBinary()+r+f+u+f,t.setRequestHeader("Content-Type","multipart/form-data;boundary="+u),t.sendAsBinary(s)):window.FormData&&(o=new FormData,o.append(i.name,n),t.send(o))}var r="\r\n",u="iloveigloo",f="--",i={name:"uploadedFile",postUrl:"Upload.ashx",onClientAbort:null,onClientError:null,onClientLoad:null,onClientLoadEnd:null,onClientLoadStart:null,onClientProgress:null,onServerAbort:null,onServerError:null,onServerLoad:null,onServerLoadStart:null,onServerProgress:null,onServerReadyStateChange:null,onSuccess:null,limitItem:30};return t&&n.extend(i,t),this.each(function(){var t=n(this);t.is('[type="file"]')?t.bind("change",function(){for(var t=this.files,n=0;n<t.length;n++)n<i.limitItem&&e(t[n])}):t.bind("dragenter dragover",function(){return!1}).bind("drop",function(n){for(var i=n.originalEvent.dataTransfer.files,t=0;t<i.length;t++)e(i[t]);return!1})})}}(jQuery);var timmer,MIN_SSKEYWORD_LENGTH=2,urlRoot=window.location.origin,searching=!1,inValidChar=/:|;|!|@@|#|\$|%|\^|&|\*|' |"|>|<|,|\?|`|~|\+|=|_|-|\(|\)|{|}|\[|\]|\\|\|/gi,isMobile=!1,idDel=0,idActive=0,isActive,elm;$(document).ready(function(){$(".up-product").submit(function(n){n.preventDefault()});$(".click-find input").keyup(function(n){var t,i;(n.preventDefault(),t=$(".click-find input").val(),t=t.replace(inValidChar,""),i=t.trim().toLowerCase(),i.length<MIN_SSKEYWORD_LENGTH)||(n.type=="submit"||n.which==13)&&(query.PageIndex=0,getProductList(t))});$(".icon-search").click(function(n){var t,i;(n.preventDefault(),t=$(".click-find input").val(),t=t.replace(inValidChar,""),i=t.trim().toLowerCase(),i.length<MIN_SSKEYWORD_LENGTH)||(query.PageIndex=0,getProductList(t))});$(".click-del").click(function(){idDel=$(this).data("id");$(".popup-delsp").addClass("active")});$(".btn-back").click(function(){$(".popup-delsp").removeClass("active")});$(".btn-del").click(function(n){$(".popup-delsp").removeClass("active");n.preventDefault();idDel>0&&SubmitDeleteProduct(idDel)});$(".close-send").click(function(){location.reload()});$(".btn-back-update").click(function(){$(".popup-update-status").removeClass("active")});$(".btn-update").click(function(){$.ajax({url:"/Profile/ActiveProduct",type:"POST",data:{productId:idActive,isActive:isActive},cache:!1,beforeSend:function(){$(".preloader").show()},success:function(n){HidePreloader();n.code===200?$(elm).prop("checked",isActive):$(elm).prop("checked",!isActive)},error:function(){alert("Hệ thống đang cập nhật. Vui lòng thử lại sau ít phút");HidePreloader()}});$(".popup-update-status").removeClass("active")})});